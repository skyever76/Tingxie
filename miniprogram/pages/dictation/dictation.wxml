<!--pages/dictation/dictation.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:if="{{loadingAudio}}" class="audio-loading">
    <text class="icon">ğŸ”Š</text>
    <text>éŸ³é¢‘åŠ è½½ä¸­...</text>
  </view>

  <block wx:else>
    <!-- è¯åº“åç§° -->
    <view class="wordlist-name">
      <text>{{wordList.name}}</text>
    </view>

    <!-- è¿›åº¦æ¡ -->
    <view class="progress-bar">
      <view class="progress" style="width: {{(currentIndex + 1) / words.length * 100}}%"></view>
      <text class="progress-text">{{currentIndex + 1}}/{{words.length}}</text>
    </view>

    <!-- å½“å‰è¯è¯­ -->
    <view class="word-display">
      <block wx:if="{{showAnswer}}">
        <text class="word">{{words[currentIndex]}}</text>
        <text class="pinyin" wx:if="{{settings.showPinyin && currentWord.pinyin}}">{{currentWord.pinyin}}</text>
      </block>
      <text wx:else class="placeholder">è¯·å¬å†™</text>
    </view>

    <!-- æ§åˆ¶æŒ‰é’® -->
    <view class="control-bar">
      <button 
        class="control-btn" 
        bindtap="prevWord"
        disabled="{{currentIndex === 0}}"
        hover-class="button-hover"
      >
        <text class="icon">â†</text>
        <text>ä¸Šä¸€ä¸ª</text>
      </button>
      <button 
        class="control-btn primary" 
        bindtap="playCurrentWord"
        loading="{{isPlaying}}"
        hover-class="button-hover"
      >
        <text class="icon">â–¶</text>
        <text>æ’­æ”¾</text>
      </button>
      <button 
        class="control-btn" 
        bindtap="nextWord"
        disabled="{{currentIndex === words.length - 1}}"
        hover-class="button-hover"
      >
        <text>ä¸‹ä¸€ä¸ª</text>
        <text class="icon">â†’</text>
      </button>
    </view>

    <!-- ç­”æ¡ˆæ§åˆ¶ -->
    <view class="answer-bar">
      <button 
        class="answer-btn" 
        bindtap="toggleAnswer"
        hover-class="button-hover"
      >
        <text class="icon">{{showAnswer ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸'}}</text>
        <text>{{showAnswer ? 'éšè—ç­”æ¡ˆ' : 'æ˜¾ç¤ºç­”æ¡ˆ'}}</text>
      </button>
    </view>

    <!-- è®¾ç½®é¢æ¿ -->
    <view class="settings-panel">
      <view class="setting-item">
        <text class="setting-label">æ’­æ”¾é€Ÿåº¦</text>
        <slider 
          class="setting-slider" 
          min="0.5" 
          max="2" 
          step="0.1" 
          value="{{settings.playSpeed}}"
          bindchange="changeSpeed"
          activeColor="var(--primary-color)"
          block-size="24"
        />
        <text class="setting-value">{{settings.playSpeed}}x</text>
      </view>

      <view class="setting-item">
        <text class="setting-label">é‡å¤æ¬¡æ•°</text>
        <slider 
          class="setting-slider" 
          min="1" 
          max="5" 
          step="1" 
          value="{{settings.repeatTimes}}"
          bindchange="changeRepeat"
          activeColor="var(--primary-color)"
          block-size="24"
        />
        <text class="setting-value">{{settings.repeatTimes}}æ¬¡</text>
      </view>

      <view class="setting-item">
        <text class="setting-label">è‡ªåŠ¨æ’­æ”¾</text>
        <switch 
          checked="{{settings.autoNext}}" 
          bindchange="toggleAutoNext"
          color="var(--primary-color)"
        />
      </view>

      <view class="setting-item">
        <text class="setting-label">éšæœºé¡ºåº</text>
        <switch 
          checked="{{settings.randomOrder}}" 
          bindchange="toggleRandomOrder"
          color="var(--primary-color)"
        />
      </view>

      <view class="setting-item">
        <text class="setting-label">æ˜¾ç¤ºæ‹¼éŸ³</text>
        <switch 
          checked="{{settings.showPinyin}}" 
          bindchange="togglePinyin"
          color="var(--primary-color)"
        />
      </view>
    </view>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <view class="footer-info">
      <text wx:if="{{lessonId}}">æ­£åœ¨å¬å†™è¯¾æ–‡ï¼š{{lessonId}}</text>
      <text wx:if="{{listId}}">æ­£åœ¨å¬å†™Listï¼š{{listId}}</text>
    </view>

    <view wx:for="{{wordList}}" wx:key="index">
      <text>{{item.text}}</text>
      <text wx:if="{{pinyinList[index]}}">ï¼ˆ{{pinyinList[index]}}ï¼‰</text>
    </view>
  </block>
</view>