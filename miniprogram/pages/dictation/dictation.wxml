<!--pages/dictation/dictation.wxml-->
<view class="container">
  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <block wx:else>
    <!-- 词库名称 -->
    <view class="wordlist-name">
      <text>{{wordList.name}}</text>
    </view>

    <!-- 进度条 -->
    <view class="progress-bar">
      <view class="progress" style="width: {{(currentIndex + 1) / words.length * 100}}%"></view>
      <text class="progress-text">{{currentIndex + 1}}/{{words.length}}</text>
    </view>

    <!-- 当前词语 -->
    <view class="word-card">
      <view class="word-text" wx:if="{{showAnswer}}">
        {{currentWord.text}}
      </view>
      <view class="word-text placeholder" wx:else>
        点击显示答案
      </view>
      <view class="word-pinyin" wx:if="{{showAnswer && settings.showPinyin && currentWord.pinyin}}">
        {{currentWord.pinyin}}
      </view>
    </view>

    <!-- 控制按钮 -->
    <view class="control-bar">
      <button 
        class="control-btn" 
        bindtap="prevWord"
        disabled="{{currentIndex === 0}}"
      >上一个</button>
      <button 
        class="control-btn primary" 
        bindtap="playCurrentWord"
        loading="{{isPlaying}}"
      >播放</button>
      <button 
        class="control-btn" 
        bindtap="nextWord"
        disabled="{{currentIndex === words.length - 1}}"
      >下一个</button>
    </view>

    <!-- 答案控制 -->
    <view class="answer-bar">
      <button 
        class="answer-btn" 
        bindtap="toggleAnswer"
      >{{showAnswer ? '隐藏答案' : '显示答案'}}</button>
    </view>

    <!-- 设置面板 -->
    <view class="settings-panel">
      <view class="setting-item">
        <text class="setting-label">播放速度</text>
        <slider 
          class="setting-slider" 
          min="0.5" 
          max="2" 
          step="0.1" 
          value="{{settings.playSpeed}}"
          bindchange="changeSpeed"
        />
        <text class="setting-value">{{settings.playSpeed}}x</text>
      </view>

      <view class="setting-item">
        <text class="setting-label">重复次数</text>
        <slider 
          class="setting-slider" 
          min="1" 
          max="5" 
          step="1" 
          value="{{settings.repeatTimes}}"
          bindchange="changeRepeat"
        />
        <text class="setting-value">{{settings.repeatTimes}}次</text>
      </view>

      <view class="setting-item">
        <text class="setting-label">自动播放</text>
        <switch 
          checked="{{settings.autoNext}}" 
          bindchange="toggleAutoNext"
        />
      </view>

      <view class="setting-item">
        <text class="setting-label">随机顺序</text>
        <switch 
          checked="{{settings.randomOrder}}" 
          bindchange="toggleRandomOrder"
        />
      </view>

      <view class="setting-item">
        <text class="setting-label">显示拼音</text>
        <switch 
          checked="{{settings.showPinyin}}" 
          bindchange="togglePinyin"
        />
      </view>
    </view>

    <view style="padding: 40rpx;">
      <text wx:if="{{lessonId}}">正在听写课文：{{lessonId}}</text>
      <text wx:if="{{listId}}">正在听写List：{{listId}}</text>
    </view>
  </block>
</view>